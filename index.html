<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>한국 서핑 스팟 가이드 – 모바일 가독성 강화판</title>
  <style>
    * { box-sizing: border-box; }
    :root{
      --bg: #0891b2;
      --glass: rgba(255,255,255,.16);
      --glass-2: rgba(248,249,250,.18);
      --ink: #2c3e50;
      --muted: #6b8a99;
      --good-1:#27ae60;--good-2:#2ecc71; /* 바람(초록) */
      --swell-1:#1f9bd1;--swell-2:#0b3b47; /* 파도(파랑) */
      --sand-1:#f39c12;--sand-2:#e67e22;
      --reef-1:#8e44ad;--reef-2:#9b59b6;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      background-image:url('https://wrdesign5.github.io/images/Featured-image-Uluwatu-Bali-Indonesia-1244x700.jpg');
      background-position:center; background-size:cover; background-attachment:fixed;
      min-height:100vh; padding:20px;
    }
    .container{
      max-width:1200px; margin:0 auto; background:var(--glass);
      border-radius:16px; padding:24px; box-shadow:0 20px 40px rgba(0,0,0,.15);
      backdrop-filter:saturate(1.2) blur(10px);
    }
    header{ text-align:center; margin-bottom:16px; }
    header h1{ font-size:clamp(1.6rem, 2.4vw + 1rem, 2.6rem); color:var(--ink); margin:.2rem 0; }
    header p{ color:var(--muted); }

    .actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:space-between; align-items:center; margin:16px 0 12px; }
    .left-actions{ display:flex; gap:8px; flex-wrap:wrap; }
    input[type="search"], select{
      appearance:none; border:1px solid rgba(0,0,0,.08); background:white; border-radius:10px;
      padding:.6rem .8rem; font-size:.95rem; min-width:200px;
    }
    .toggle{ cursor:pointer; border:1px solid rgba(255,255,255,.5); background:var(--glass-2); color:#03414e; padding:.55rem .8rem; border-radius:10px; }

    .table-container{ overflow:auto; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,.08); background:var(--glass); --sticky: sticky; }
    table{ width:100%; border-collapse:collapse; backdrop-filter: blur(4px); }
    caption{ text-align:left; padding:10px 12px; color:#0b3b47; font-weight:600; }
    thead{ position:var(--sticky); top:0; z-index:2; background:linear-gradient(135deg, rgba(52,152,219,.9), rgba(41,128,185,.9)); color:white; }
    th,td{ padding:12px 10px; text-align:center; }
    th{ font-weight:700; font-size:.9rem; }
    tbody tr{ transition: transform .16s ease, background-color .2s ease; }
    tbody tr:hover{ background-color: rgba(248,249,250,.5); transform: translateY(-1px); }
    tbody tr:nth-child(even){ background-color: rgba(248,249,250,.28); }

    .beach-info{ display:flex; align-items:center; gap:10px; }
    .beach-image{ width:44px; height:44px; border-radius:10px; object-fit:cover; box-shadow:0 2px 8px rgba(0,0,0,.15); }
    .beach-name{ font-weight:700; color:var(--ink); }
    .region{ color:#637a87; font-size:.92rem; }

    .wind-arrows{ display:flex; gap:6px; justify-content:center; flex-wrap:wrap; }
    .wind-arrow{ width:36px; height:24px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:16px; color:white; font-weight:700; background:linear-gradient(135deg, var(--good-1), var(--good-2)); box-shadow:0 2px 4px rgba(39,174,96,.28); }

    /* 스웰(파도) 표시 */
    .swell-arrows{ display:flex; gap:6px; justify-content:center; flex-wrap:wrap; }
    .swell-group{ display:flex; gap:4px; margin:2px 4px; }
    .swell-arrow{ width:36px; height:24px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:16px; color:white; font-weight:700; background:linear-gradient(135deg,var(--swell-1),var(--swell-2)); box-shadow:0 2px 4px rgba(31,155,209,.28); }

    /* 바람/파도 3줄 스택 표시 */
    .stack{ display:flex; flex-direction:column; gap:4px; align-items:center; }
    .stack-line{ display:flex; gap:6px; align-items:center; justify-content:center; }

    .bottom-type{ padding:5px 12px; border-radius:14px; font-size:.82rem; font-weight:700; color:white; display:inline-block; }
    .bottom-type.sand{ background:linear-gradient(135deg, var(--sand-1), var(--sand-2)); }
    .bottom-type.reef{ background:linear-gradient(135deg, var(--reef-1), var(--reef-2)); }

    .difficulty{ padding:4px 10px; border-radius:12px; font-size:.82rem; font-weight:700; color:white; }
    .beginner{ background:#2ecc71; }
    .intermediate{ background:#f39c12; }
    .advanced{ background:#e74c3c; }

    .legend, .tips{ background:var(--glass-2); padding:16px; border-radius:12px; margin-top:14px; backdrop-filter: blur(5px); }
    .legend h3, .tips h3{ margin:0 0 10px; color:var(--ink); }
    .legend-items{ display:grid; grid-template-columns:repeat(auto-fit, minmax(260px,1fr)); gap:10px; }
    .legend-item{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }

    .tips ul{ list-style:none; padding-left:0; margin:0; }
    .tips li{ margin:8px 0; padding-left:22px; position:relative; }
    .tips li::before{ content:"🌊"; position:absolute; left:0; }

    /* 카드형 레이아웃 (모바일 전환) */
    .cards{ display:none; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:12px; }
    .card{ background:var(--glass); border:1px solid rgba(255,255,255,.35); border-radius:14px; padding:12px; box-shadow:0 4px 12px rgba(0,0,0,.08); }
    .card header{ display:flex; align-items:center; gap:10px; justify-content:flex-start; margin-bottom:8px; }
    .meta{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .meta-grid{ display:grid; grid-template-columns:1fr 1fr; gap:8px; margin:8px 0; }
    .subhead{ font-size:.78rem; font-weight:700; padding:3px 8px; border-radius:999px; display:inline-block; color:white; }
    .subhead.wind{ background:linear-gradient(135deg, var(--good-1), var(--good-2)); }
    .subhead.swell{ background:linear-gradient(135deg, var(--swell-1), var(--swell-2)); }

    /* 모바일 힌트 바: 색상 의미를 텍스트로 명확히 */
    .mobile-hint{
      display:none; position:sticky; top:8px; z-index:3;
      background:rgba(255,255,255,.6); backdrop-filter: blur(8px);
      padding:8px 10px; border-radius:12px; margin:8px 0;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
    }
    .pill{ display:inline-block; font-size:.8rem; font-weight:700; padding:4px 10px; border-radius:999px; color:#fff; margin-right:6px; }
    .pill.wind{ background:linear-gradient(135deg, var(--good-1), var(--good-2)); }
    .pill.swell{ background:linear-gradient(135deg, var(--swell-1), var(--swell-2)); }

    :focus-visible{ outline: 3px solid #1f9bd1; outline-offset: 2px; border-radius:8px; }
    @media (max-width: 820px){
      .container{ padding:14px; }
      th,td{ padding:9px 6px; font-size:.85rem; }
    }
    @media (max-width: 680px){
      .table-container{ display:none; }
      .cards{ display:grid; }
      input[type="search"], select{ min-width:0; flex:1; }
      .mobile-hint{ display:block; }
    }
  </style>
</head>
<body>
  <div class="container" role="application">
    <header>
      <h1 aria-label="한국 서핑 스팟 가이드">🏄‍♂️ 한국 서핑 스팟 가이드</h1>
      <p>국내 주요 스팟의 바람·바닥·시즌 정보를 한눈에</p>
    </header>

    <div class="actions" aria-label="필터 및 보기 전환">
      <div class="left-actions">
        <input id="q" type="search" placeholder="스팟 또는 지역 검색" aria-label="스팟 검색" />
        <select id="regionFilter" aria-label="지역 필터">
          <option value="">전체 지역</option>
        </select>
        <select id="levelFilter" aria-label="난이도 필터">
          <option value="">전체 난이도</option>
          <option value="beginner">초급</option>
          <option value="intermediate">중급</option>
          <option value="advanced">고급</option>
        </select>
      </div>
      <button class="toggle" id="sortBtn" aria-pressed="false">가나다 순 정렬</button>
    </div>

    <!-- 모바일 색상 안내 바 -->
    <div class="mobile-hint" aria-label="모바일 색상 안내">
      <span class="pill wind">바람(오프쇼어)</span>
      <span class="pill swell">파도(베스트)</span>
    </div>

    <div class="table-container" role="region" aria-labelledby="tableCaption">
      <table id="surfTable">
        <caption id="tableCaption">한국 서핑 스팟 목록</caption>
        <thead>
          <tr>
            <th scope="col">해변</th>
            <th scope="col">지역</th>
            <th scope="col" title="오프쇼어">바람(오프쇼어)</th>
            <th scope="col">파도(베스트)</th>
            <th scope="col">바닥</th>
            <th scope="col">베스트 계절</th>
            <th scope="col">베스트 시간</th>
            <th scope="col">난이도</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <section class="cards" id="cards" aria-label="카드 보기"></section>

    <section class="legend" aria-label="범례">
      <h3>범례</h3>
      <div class="legend-items">
        <div class="legend-item"><div class="wind-arrow" aria-hidden="true">↓</div><span>오프쇼어 (좋은 조건)</span></div>
        <div class="legend-item"><div class="bottom-type sand">모래</div><span>맨발 OK</span></div>
        <div class="legend-item"><div class="bottom-type reef">리프</div><span>부츠 권장</span></div>
        <div class="legend-item"><div class="bottom-type sand">모래</div><div class="bottom-type reef">리프</div><span>혼합 스팟</span></div>
        <!-- 바람 → 파도 예시 -->
        <div class="legend-item" aria-label="바람에서 파도 방향 예시">
          <span style="font-weight:700; color:var(--ink)">예시</span>
          <div class="stack" style="min-width:60px">
            <div class="stack-line"><span class="wind-arrow" title="오프쇼어 E">←</span></div>
          </div>
          <span style="opacity:.8">→</span>
          <div class="stack-line">
            <span class="swell-arrow" title="스웰 NE">↙</span>
            <span class="swell-arrow" title="스웰 E">←</span>
            <span class="swell-arrow" title="스웰 SE">↖</span>
          </div>
          <span style="opacity:.8">바람 1줄 → 파도 3방향</span>
        </div>
      </div>
    </section>

    <section class="tips" aria-label="서핑 팁">
      <h3>💡 서핑 팁</h3>
      <ul>
        <li><strong>바람 체크:</strong> 오프쇼어일수록 파도가 정돈됩니다</li>
        <li><strong>바람 세기:</strong> 2–6 m/s(약 4–12노트) 오프쇼어가 무난, 7 m/s↑ 온쇼어·사이드온이면 면이 쉽게 무너집니다</li>
        <li><strong>스웰 주기(Period):</strong> 8–12초가 국내 보편적 베스트, 6초 이하면 짧고 흐트러지기 쉬움, 12초↑는 파워 좋지만 사이즈/수심 체크</li>
        <li><strong>조석:</strong> 만조 전후 2시간이 보편적으로 유리합니다</li>
        <li><strong>계절:</strong> 9–10월이 국내 베스트 시즌</li>
        <li><strong>리프:</strong> 리프 부츠 착용 권장</li>
        <li><strong>화살표:</strong> 바람이 불어가는 방향 표시</li>
      </ul>
    </section>
  </div>

  <script>
    'use strict';

    const surfSpots = [
      { name:"송정 해수욕장", region:"부산", image:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=200&fit=crop", offshore:["NW","N","NE"], onshore:["SE","S","SW"], bottomType:"sand", bestSeason:"연중", bestTime:"만조 2–3시간 전후", difficulty:"beginner" },
      { name:"죽도 해변", region:"양양", image:"https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조시", difficulty:"beginner" },
      { name:"기사문 해변", region:"양양", image:"https://images.unsplash.com/photo-1544198365-f5d60b6d8190?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 1–2시간 전", difficulty:"intermediate" },
      { name:"서피비치", region:"양양", image:"https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조시", difficulty:"intermediate" },
      { name:"만리포 해변", region:"태안", image:"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=200&h=200&fit=crop", offshore:["E","NE","SE"], onshore:["W","NW","SW"], bottomType:"sand", bestSeason:"봄·가을", bestTime:"만조시", difficulty:"beginner" },
      { name:"중문색달해변", region:"제주", image:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=200&h=200&fit=crop", offshore:["N","NE","NW"], onshore:["S","SE","SW"], bottomType:"mixed", bestSeason:"9–11월·3–5월", bestTime:"만조 2시간 전후", difficulty:"advanced" },
      { name:"고흥 해수욕장", region:"전남 고흥", image:"https://images.unsplash.com/photo-1544551763-77ef2d0cfc6c?w=200&h=200&fit=crop", offshore:["N","NW","NE"], onshore:["S","SW","SE"], bottomType:"sand", bestSeason:"연중", bestTime:"만조시", difficulty:"intermediate" },
      { name:"월포해변", region:"포항", image:"https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 1–2시간 전", difficulty:"intermediate" },
      { name:"대진해변", region:"동해", image:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 2시간 전후", difficulty:"intermediate" },
      { name:"정동진해변", region:"강릉", image:"https://images.unsplash.com/photo-1544198365-f5d60b6d8190?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조시", difficulty:"beginner" },
      { name:"속초해변", region:"속초", image:"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 1–2시간 전", difficulty:"beginner" },
      { name:"삼포해변", region:"고성", image:"https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조시", difficulty:"intermediate" },
      { name:"강문해변", region:"강릉", image:"https://images.unsplash.com/photo-1544551763-77ef2d0cfc6c?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 2시간 전후", difficulty:"beginner" },
      { name:"경포해변", region:"강릉", image:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조시", difficulty:"beginner" }
    ];

    // 사용자 추가 스팟 (없는 것만 병합)
    (function addUserSpots(){
      const have = new Set(surfSpots.map(s=>s.name));
      const newSpots = [
        { name:"제주 이호테우해변", region:"제주", image:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=200&fit=crop", offshore:["S","SE","SW"], onshore:["N","NE","NW"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"제주 월정해변", region:"제주", image:"https://images.unsplash.com/photo-1544198365-f5d60b6d8190?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"beginner" },
        { name:"양양 인구해변", region:"양양", image:"https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"양양 갯마을해변", region:"양양", image:"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"intermediate" },
        { name:"양양 남애3리해변", region:"양양", image:"https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"intermediate" },
        { name:"양양 물치해변", region:"양양", image:"https://images.unsplash.com/photo-1544551763-77ef2d0cfc6c?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"양양 설악해변", region:"양양", image:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"intermediate" },
        { name:"양양 동산해변", region:"양양", image:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"양양 남애1리 해변", region:"양양", image:"https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"양양 하조대해변", region:"양양", image:"https://images.unsplash.com/photo-1544198365-f5d60b6d8190?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"beginner" },
        { name:"양양 동호해변", region:"양양", image:"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"intermediate" },
        { name:"양양 낙산해변", region:"양양", image:"https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"beginner" },
        { name:"양양 정암해변", region:"양양", image:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"intermediate" },
        { name:"부산 다대포 해변", region:"부산", image:"https://images.unsplash.com/photo-1544198365-f5d60b6d8190?w=200&h=200&fit=crop", offshore:["N","NE","NW"], onshore:["S","SE","SW"], bottomType:"sand", bestSeason:"봄·가을", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"고성 송지호해변", region:"고성", image:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"intermediate" },
        { name:"고성 천진해변", region:"고성", image:"https://images.unsplash.com/photo-1544198365-f5d60b6d8190?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"강릉 금진해변", region:"강릉", image:"https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"beginner" },
        { name:"삼척 용화해변", region:"삼척", image:"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조 전후", difficulty:"intermediate" },
        { name:"포항 신항만해변", region:"포항", image:"https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=200&fit=crop", offshore:["W","NW","SW"], onshore:["E","NE","SE"], bottomType:"sand", bestSeason:"9–11월", bestTime:"만조", difficulty:"beginner" },
        { name:"울산 진하해변", region:"울산", image:"https://images.unsplash.com/photo-1544198365-f5d60b6d8190?w=200&h=200&fit=crop", offshore:["N","NE","NW"], onshore:["S","SE","SW"], bottomType:"sand", bestSeason:"봄·가을", bestTime:"만조 전후", difficulty:"beginner" },
        { name:"고흥 남열 해돋이해변", region:"전남 고흥", image:"https://images.unsplash.com/photo-1544551763-77ef2d0cfc6c?w=200&h=200&fit=crop", offshore:["N","NE","NW"], onshore:["S","SE","SW"], bottomType:"sand", bestSeason:"봄·가을", bestTime:"만조 전후", difficulty:"intermediate" }
      ];
      newSpots.forEach(s=>{ if(!have.has(s.name)) surfSpots.push(s); });
    })();

    // 아이콘(바람/스웰)
    const ARROWS = { N:"↓", NE:"↙", E:"←", SE:"↖", S:"↑", SW:"↗", W:"→", NW:"↘" };

    const $tbody = document.getElementById('tbody');
    const $cards = document.getElementById('cards');
    const $q = document.getElementById('q');
    const $regionFilter = document.getElementById('regionFilter');
    const $levelFilter = document.getElementById('levelFilter');
    const $sortBtn = document.getElementById('sortBtn');

    let state = { sortAsc: true, query:"", region:"", level:"" };

    const DIRS = ['N','NE','E','SE','S','SW','W','NW'];
    function waveTripletFromOffshore(dir){
      const idx = DIRS.indexOf(dir);
      const opp = (idx + 4) % 8; // 반대 방향(스웰 중심)
      const left = (opp + 7) % 8; // -45°
      const right = (opp + 1) % 8; // +45°
      return [DIRS[left], DIRS[opp], DIRS[right]];
    }

    function windColumn(offshoreList){
      const lines = offshoreList.map(d=>`<div class='stack-line'><span class='wind-arrow' title='오프쇼어 ${d}'>${ARROWS[d]}</span></div>`).join('');
      return `<div class='stack' aria-label='오프쇼어 3줄'>${lines}</div>`;
    }
    function waveColumn(offshoreList){
      const groups = offshoreList.map(d=>{
        const tri = waveTripletFromOffshore(d);
        const arrows = tri.map(t=>`<span class='swell-arrow' title='스웰 ${t}'>${ARROWS[t]}</span>`).join('');
        return `<div class='stack-line'>${arrows}</div>`;
      }).join('');
      return `<div class='stack' aria-label='베스트 스웰 3줄'>${groups}</div>`;
    }

    function bottomBadge(type){
      if(type === 'mixed'){
        // 혼합 스팟은 모래+리프 배지를 함께 표기
        return `<span class="bottom-type sand">모래</span> <span class="bottom-type reef">리프</span>`;
      }
      const map={ sand:{t:'모래',c:'sand'}, reef:{t:'리프',c:'reef'} };
      const i=map[type]||{t:type,c:'sand'};
      return `<span class="bottom-type ${i.c}">${i.t}</span>`;
    }
    function levelBadge(l){
      const map={ beginner:{t:'초급',c:'beginner'}, intermediate:{t:'중급',c:'intermediate'}, advanced:{t:'고급',c:'advanced'} };
      const i=map[l]||{t:l,c:'beginner'};
      return `<span class="difficulty ${i.c}">${i.t}</span>`;
    }

    // region options
    [...new Set(surfSpots.map(s=>s.region))].sort().forEach(r=>{
      const opt=document.createElement('option'); opt.value=r; opt.textContent=r; $regionFilter.appendChild(opt);
    });

    function applyFilters(){
      const q = state.query.toLowerCase();
      return surfSpots.filter(s=>
        (!state.region || s.region===state.region) &&
        (!state.level || s.difficulty===state.level) &&
        (s.name.toLowerCase().includes(q) || s.region.toLowerCase().includes(q))
      );
    }

    function rowTemplate(s){
      return `<tr tabindex="0">
        <td><div class="beach-info"><img loading="lazy" src="${s.image}" alt="${s.name} 사진" class="beach-image" width="44" height="44" /><div><div class="beach-name">${s.name}</div></div></div></td>
        <td class="region">${s.region}</td>
        <td>${windColumn(s.offshore)}</td>
        <td>${waveColumn(s.offshore)}</td>
        <td>${bottomBadge(s.bottomType)}</td>
        <td class="season">${s.bestSeason}</td>
        <td class="time">${s.bestTime}</td>
        <td>${levelBadge(s.difficulty)}</td>
      </tr>`;
    }

    function cardTemplate(s){
      return `<article class="card" tabindex="0" aria-label="${s.name}">
        <header><img loading="lazy" class="beach-image" alt="${s.name} 사진" src="${s.image}" width="44" height="44" /><strong>${s.name}</strong><span class="region">· ${s.region}</span></header>
        <div class="meta">${bottomBadge(s.bottomType)} ${levelBadge(s.difficulty)}</div>
        <div class="meta meta-grid">
          <div>
            <div class="subhead wind">바람(오프쇼어)</div>
            ${windColumn(s.offshore)}
          </div>
          <div>
            <div class="subhead swell">파도(베스트)</div>
            ${waveColumn(s.offshore)}
          </div>
        </div>
        <div class="meta"><span>시즌: ${s.bestSeason}</span><span>베스트: ${s.bestTime}</span></div>
      </article>`;
    }

    function render(){
      let data = applyFilters();
      data = data.sort((a,b)=> state.sortAsc ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name));
      document.getElementById('tbody').innerHTML = data.map(rowTemplate).join('');
      document.getElementById('cards').innerHTML = data.map(cardTemplate).join('');
      [...document.querySelectorAll('#tbody tr'), ...document.querySelectorAll('#cards .card')].forEach(el=>{
        el.addEventListener('click', ()=> tip(el.querySelector('.beach-name')?.textContent || el.getAttribute('aria-label')));
        el.addEventListener('keyup', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); el.click(); } });
      });
    }

    function tip(name){
      const msg = `${name}\n\n💡 팁: 오프쇼어일 때 컨디션이 정돈돼요!\n🌊 만조 전후 2시간 확인하기`;
      toast(msg);
    }

    function toast(text){
      const t = document.createElement('div');
      t.textContent = text; t.setAttribute('role','status');
      Object.assign(t.style,{
        position:'fixed', left:'50%', bottom:'24px', transform:'translateX(-50%)',
        background:'rgba(0,0,0,.75)', color:'white', padding:'12px 14px', borderRadius:'12px',
        maxWidth:'min(90vw, 520px)', zIndex:9999, whiteSpace:'pre-wrap', textAlign:'left', boxShadow:'0 6px 18px rgba(0,0,0,.3)'
      });
      document.body.appendChild(t);
      setTimeout(()=> t.remove(), 2600);
    }

    // wiring
    document.getElementById('q').addEventListener('input', (e)=>{ state.query = e.target.value; render(); });
    document.getElementById('regionFilter').addEventListener('change', (e)=>{ state.region = e.target.value; render(); });
    document.getElementById('levelFilter').addEventListener('change', (e)=>{ state.level = e.target.value; render(); });
    document.getElementById('sortBtn').addEventListener('click', ()=>{
      state.sortAsc = !state.sortAsc;
      const btn = document.getElementById('sortBtn');
      btn.ariaPressed = String(!JSON.parse(btn.ariaPressed||'false'));
      btn.textContent = state.sortAsc ? '가나다 순 정렬' : '가나다 역순 정렬';
      render();
    });

    // 초기 렌더
    render();

    // --- 간단 테스트(콘솔) ---
    (function tests(){
      try {
        console.assert(JSON.stringify(waveTripletFromOffshore('W')) === JSON.stringify(['NE','E','SE']), 'Test W failed');
        console.assert(JSON.stringify(waveTripletFromOffshore('NW')) === JSON.stringify(['E','SE','S']), 'Test NW failed');
        console.assert(JSON.stringify(waveTripletFromOffshore('SW')) === JSON.stringify(['N','NE','E']), 'Test SW failed');
        const windHTML = windColumn(['W','NW','SW']);
        const windCount = (windHTML.match(/class='wind-arrow'/g)||[]).length;
        console.assert(windCount === 3, 'WindColumn should render 3 arrows, got ' + windCount);
        const waveHTML = waveColumn(['W','NW','SW']);
        const waveCount = (waveHTML.match(/class='swell-arrow'/g)||[]).length;
        console.assert(waveCount === 9, 'WaveColumn should render 9 arrows, got ' + waveCount);
      } catch (e) {
        console.warn('Runtime tests raised', e);
      }
    })();
  </script>
</body>
</html>
